<center>哈尔滨工业大学计算机科学与技术学院</center>
<center style="font-size:30px">实验报告 </center><br></br>
<center>课程名称： 计算机网络</center>
<center>课程类型： 必修</center>
<center>实验题目： 利用 Wireshark 进行协议分析</center>
<center>学号：1171000405</center>
<center>姓名：许天骁</center>
<div STYLE="page-break-after: always;"></div>

#### 一、实验目的
&ensp;&ensp;熟悉并掌握 Wireshark 的基本操作，了解网络协议实体间进行交互以
及报文交换的情况。

#### 二、实验要求及实验环境

##### 实验内容
1. 学习 Wireshark 的使用
2. 利用 Wireshark 分析 HTTP 协议
3. 利用 Wireshark 分析 TCP 协议
4. 利用 Wireshark 分析 IP 协议
5. 利用 Wireshark 分析 Ethernet 数据帧
选做内容：
a. 利用 Wireshark 分析 DNS 协议
b. 利用 Wireshark 分析 UDP 协议
c. 利用 Wireshark 分析 ARP 协议

##### 实验环境
1. 硬件环境：X64CPU; 4.0Ghz; 16G RAM
2. 软件环境：Windows 64位
3. 开发环境：Python 3.6.8(64位); Visual Stuio Code

#### 三、实验过程及结果
##### HTTP分析
1. 你的浏览器运行的是 HTTP1.0，还是 HTTP1.1？你所访问的服务器所运行 HTTP 协议的版本号是多少？
   <img src="./1.png">
   运行的是HTTP1.1，访问的服务器运行的也是HTTP1.1
2. 你的浏览器向服务器指出它能接收何种语言版本的对象？
   <img src="./2.png">
   可以接受英语和中文
3. 你的计算机的 IP 地址是多少？服务器 http://hitgs.hit.edu.cn的 IP 地址是多少？
   <img src="./1.png">
   我的计算机的IP地址是192.168.1.237， 服务器的IP地址是202.118.254.237
4. 从服务器向你的浏览器返回的状态代码是多少？
   <img src="./1.png">
   从服务器向我的计算机返回的状态代码是200
5. 分析你的浏览器向服务器发出的第一个 HTTP GET 请求的内容，在该请求报文中，是否有一行是：IF-MODIFIED-SINCE？
   <img src="./6.png">
   在请求报文中不存在IF-MODIFIED-SINCE
6. 分析服务器响应报文的内容，服务器是否明确返回了文件的内容？如何获知？
   <img src="./4.png">
   <img src="./5.png">
   服务器明确了返回文件的内容，如果有data段，则代表返回了文件内容。如果没有data段则返回了文件内容。
7. 分析你的浏览器向服务器发出的较晚的“HTTP GET”请求，在该请求报文中是否有一行是：IF-MODIFIED-SINCE？如果有，在该首部行后面跟着的信息是什么？
   <img src="./3.png">
   后面跟着的信息是访问文件的上次修改时间。
8. 服务器对较晚的 HTTP GET 请求的响应中的 HTTP 状态代码是多少？服务器是否明确返回了文件的内容？请解释。
   <img src="./5.png">
   响应的状态码是304，服务器没有返回文件内容。GET请求中的IF-MODIFIED-SINCE是向主机询问访问的文件是否从上次修改的时间后发生了修改。若没有修改，服务器会响应304状态码，表示文件没有发生修改，可以直接使用缓存中的文件。所以没有返回文件的内容。
##### TCP分析
1. 向 gaia.cs.umass.edu 服务器传送文件的客户端主机的 IP 地址和TCP 端口号是多少？
    <img src="./7.png">
   客户端主机的IP地址是：192.168.1.237
   TCP端口号是：10134
2. Gaia.cs.umass.edu 服务器的 IP 地址是多少？对这一连接，它用来发送和接收 TCP 报文的端口号是多少？
   <img src="./7.png">
   服务器的IP地址是：128.119.245.12
   接受TCP报文的端口号是：80
3. 客户服务器之间用于初始化 TCP 连接的 TCP SYN 报文段的序号（sequence number）是多少？在该报文段中，是用什么来标示该报文段是 SYN 报文段的？
   <img src="./8.png">
   SYN报文段的序号seq=0
   <img src="./9.png">
   在该报文段中，使用在特定位置记1来表示该报文段是SYN报文段。
4. 服务器向客户端发送的 SYNACK 报文段序号是多少？该报文段中，Acknowledgement 字段的值是多少？Gaia.cs.umass.edu 服务器是如何决定此值的？在该报文段中，是用什么来标示该报文段是SYNACK 报文段的？
   <img src="./10.png">
   服务器向客户端发送的 SYN ACK 报文段序号是1，该报文段中ACK字段的值是又由客户端发送的SYN报文段中的seq决定的，ack=seq+1
   <img src="./11.png">
   该报文段中，使用在特定位置记1来表示该报文段是SYN ACK报文段。
5. 你能从捕获的数据包中分析出 tcp 三次握手过程吗？
   第一次握手：
   <img src="./12.png">
   客户端向服务器发送SYN报文段，其中seq=0
   第二次握手：
   <img src="./13.png">
   服务器发送SYN返回报文，其中ack=seq+1，该seq是第一次握手时发送时的seq。并且发送一个随机的seq，图中显示seq=0
   第三次握手：
   <img src="./14.png">
   客户端发送ACK，并且ack信息是服务器发送的SYN报文中的seq+1
6. 包含 HTTP POST 命令的 TCP 报文段的序号是多少？
   <img src="./15.png">
   包含 HTTP POST 命令的 TCP 报文段的序号是107
7. 如果将包含 HTTP POST 命令的 TCP 报文段看作是 TCP 连接上的第一个报文段，那么该 TCP 连接上的第六个报文段的序号是多少？是何时发送的？
   <img src="./16.png">
   第六个报文段的序号是134972， 是在启动捕获后的第1.685916秒发送的。
   <img src="./17.png">
   该TCP连接上的第六个报文段的序号是152975，实在启动后的6.710953秒发送的。
8. 前六个 TCP 报文段的长度各是多少？
   112、1428、1428、1428、1043、1428
9.  在整个跟踪过程中，接收端公示的最小的可用缓存空间是多少？限制发送端的传输以后，接收端的缓存是否仍然不够用？
    <img src="./18.png">
    最小可用缓存是262144，限制发送端传输后接收端的缓存够用
10. 在跟踪文件中是否有重传的报文段？进行判断的依据是什么？
    没有重传的报文段，查看客户端发送的每一个TCP报文段，看到没有重复的报文段。
11. TCP 连接的 throughput (bytes transferred per unit time)是多少？请写出你的计算过程。
    发送数据的总长度是152871B+109*54B=158757B发送时长为1.7s
    所以速度是158757/1.7=93.386KB/s
##### IP分析
在你的捕获窗口中，应该能看到由你的主机发出的一系列ICMP Echo Request包和中间路由器返回的一系列ICMP TTL-exceeded消息。选择第一个你的主机发出的ICMP Echo Request消息，在packet details窗口展开数据包的Internet Protocol部分
1. 你主机的IP地址是什么？
   <img src="./1.png">
   我的计算机的IP地址是192.168.1.237
2. 在IP数据包头中，上层协议（upper layer）字段的值是什么？
   <img src="./19.png">
   上层协议是ICMP报文控制协议
3. IP头有多少字节？该IP数据包的净载为多少字节？并解释你是怎样确定该IP数据包的净载大小的？
   <img src="./20.png">
   IP头有20字节，IP数据报净载为36字节，因为总大小是56字节，56-20=36，所以数据报净载为36字节。
4. 该IP数据包分片了吗？解释你是如何确定该IP数据包是否进行了分片
   <img src="./21.png">
   DF=0，MF=0所以数据包没有分片

单击Source列按钮，这样将对捕获的数据包按源IP地址排序。选择第一个你的主机发出的ICMP Echo Request消息，在packet details窗口展开数据包的Internet Protocol部分。在“listing of captured packets”窗口，你会看到许多后续的ICMP消息。
1. 你主机发出的一系列ICMP消息中IP数据报中哪些字段总是发生改变？
   Time to live、Identification、Header checksum总是发生改变。
2. 哪些字段必须保持常量？哪些字段必须改变？为什么？
   除了Time to live、Identification、Header checksum都必须保持常量。
   Time to live、Identification、Header checksum字段必须改变。Time to live是为了确定路由距离，Identification是为了区分不同的IP数据报，Header checksum是根据其他的变化而发生变化的。
3. 描述你看到的IP数据包Identification字段值的形式。
   <img src="./22.png">
   是一个16进制数字。

找到由最近的路由器（第一跳）返回给你主机的 ICMPTime-to-live exceeded消息。
1. Identification字段和TTL字段的值是什么？  
   <img src="./23.png">
   Identification字段是一个16进制数字0x20a1，TTL字段是64
2. 最近的路由器（第一跳）返回给你主机的ICMP Time-to-live exceeded消息中这些值是否保持不变？为什么？
   是保持不变的，由于路由器和本地计算机连接是确定的所以不会变化。

单击Time列按钮，这样将对捕获的数据包按时间排序。找到在将包大小改为2000字节后你的主机发送的第一个ICMP Echo Request消息。
1. 该消息是否被分解成不止一个IP数据报？
2. 观察第一个IP分片，IP头部的哪些信息表明数据包被进行了分片？IP头部的哪些信息表明数据包是第一个而不是最后一个分片？该分片的长度是多少？
   MF=1表示数据包被进行了分片，并且不是最后一个分片，长度是1500B
3. 原始数据包被分成了多少片？
   2片
4. 这些分片中IP数据报头部哪些字段发生了变化？
   分⽚offset分别变为0和1480
##### 抓取ARP数据包
1. 利用 MS-DOS 命令：arp 或 c:\windows\system32\arp 查看主机上 ARP 缓存的内容。说明 ARP 缓存中每一列的含义是什么?
   <img src="./24.png">
   每一行表示一个IP地址和其对应的MAC地址
清除主机上 ARP 缓存的内容,抓取 ping 命令时的数据包。分析数据包,回答下面的问题：
1. ARP数据包的格式是怎样的？由几部分构成，各个部分所占的字节数是多少？
   <img src="./25.png">
   依次分别是：
   硬件类型：2字节
   协议类型：2字节
   硬件地址长度：1字节
   协议地址长度：1字节
   操作代码：2字节
   发送端MAC地址：6字节
   发送端IP地址：4字节
   目的MAC地址：6字节
   目的IP地址：4字节
   共计28字节
2. 如何判断一个ARP数据是请求包还是应答包
   <img src="./25.png">
   观察Opcode字段：如果是1表示请求，2为应答
3. 为什么ARP查询要在广播帧中传送，而ARP响应要在一个有着明确目的局域网地址的帧中传送？
   因为在查询的时候是不知道目的的MAC地址的，所以需要广播操作。而ARP响应的时候是明确MAC地址的，所以在响应操作在一个有着明确目的局域网地址的帧中传送。
##### 抓取 UDP 数据包
分析 QQ 通讯中捕获到的 UDP 数据包。
1. 消息是基于UDP的还是TCP的？
   <img src="./26.png">
   基于UDP的
2. 你的主机ip地址是什么？目的主机ip地址是什么？
   <img src="./26.png">
   主机IP地址：192.168.1.237
   目的主机IP地址：111.30.159.56
3. 你的主机发送QQ消息的端口号和QQ服务器的端口号分别是多少？
   <img src="./26.png">
   发送消息的端口号是4016，服务器端口号是8000
4. 数据报的格式是什么样的？都包含哪些字段，分别占多少字节？
   原端口号：4字节
   目的端口号：4字节
   报文长度：4字节
   Checksum：4字节
5. 为什么你发送一个ICQ数据包后，服务器又返回给你的主机一个ICQ数据包？这UDP的不可靠数据传输有什么联系？对比前面的TCP协议分析，你能看出UDP是无连接的吗？
   服务器返回主机一个ICQ数据包是应为UDP是不可靠的传输，服务器需要通知客户端数据已送达，而且每发送一个数据包服务器就需要返回一个ICQ数据包，UDP并不能像有连接TCP一样不间断发送数据。
##### 利用 WireShark 进行 DNS 协议分析
1. 打开浏览器键入:www.baidu.com
   <img src="./27.png">
2. 打开 Wireshark,启动抓包.
   <img src="./28.png">
3. 在控制台回车执行完毕后停止抓包.Wireshark 捕获的 DNS 报文
   <img src="./29.png">
   可以看到解析到的www.baidu.com的IP地址是182.61.200.6或182.61.200.7
#### 四、实验心得
1. HTTP的分析中，我了解了浏览器和服务器是如何交互的。
2. TCP的分析中，我深刻了解了TCP三次握手的建立以及可靠数据传输的实现细节。
3. IP的分析中，利用ICMP协议感受到了数据是如何在网络层中穿梭的。
4. ARP的分析中，通过观察ARP缓存，我感受到了路由器在数据链路层和网络层连接的重要性。
5. UDP的分析中，使用QQ作为数据发送工具，认识到了即使是QQ这种功能强大的互联网应用也是通过最底层的最简单的UDP数据报进行传输的。认识到了看似简单的UDP协议的强大性
6. DNS的分析中，简单的DNS请求也是通过路由器一步一步向互联网的深处进行访问，并且获取到了目标主机的IP地址。并且通过IP地址直接访问到了目标主机，认识到了DNS存在的重要意义。
7. 这次实验让我们自顶向下的了解了计算机网络的组成结构，分层去分析了计算机网络的各层是如何工作和连接的，让我对计算机网络的体系结构有了更加深刻的理解。